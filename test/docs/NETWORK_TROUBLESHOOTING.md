# 网络连接问题排查指南

## 🚨 常见错误类型

### 1. **连接超时错误 (Connect Timeout Error)**

#### **错误信息**
```
TypeError: fetch failed
[cause]: [Error [ConnectTimeoutError]: Connect Timeout Error] {
  code: 'UND_ERR_CONNECT_TIMEOUT'
}
```

#### **可能原因**
- 网络连接不稳定
- API 服务器响应缓慢
- 防火墙阻止连接
- DNS 解析问题

#### **解决方案**
1. **检查网络连接**
   - 确保设备已连接到互联网
   - 尝试访问其他网站验证网络状态

2. **使用网络诊断工具**
   - 在设置页面点击 🌐 诊断按钮
   - 查看详细的连接测试结果

3. **检查 API 配置**
   - 验证 Base URL 格式是否正确
   - 确认 API Key 是否有效

4. **尝试不同的网络环境**
   - 切换到移动热点
   - 使用 VPN 服务

### 2. **DNS 解析失败 (ENOTFOUND)**

#### **错误信息**
```
Error: getaddrinfo ENOTFOUND api.openai.com
```

#### **解决方案**
1. **检查域名拼写**
   - 确认 API 地址是否正确
   - 检查是否有多余的空格或字符

2. **更换 DNS 服务器**
   - 使用 8.8.8.8 (Google DNS)
   - 使用 1.1.1.1 (Cloudflare DNS)

3. **清除 DNS 缓存**
   ```bash
   # Windows
   ipconfig /flushdns
   
   # macOS
   sudo dscacheutil -flushcache
   
   # Linux
   sudo systemctl restart systemd-resolved
   ```

### 3. **连接被拒绝 (ECONNREFUSED)**

#### **错误信息**
```
Error: connect ECONNREFUSED 127.0.0.1:443
```

#### **解决方案**
1. **检查服务器状态**
   - 访问 API 提供商的状态页面
   - 确认服务是否正常运行

2. **检查端口和协议**
   - 确认使用正确的端口 (通常是 443 for HTTPS)
   - 验证协议是否正确 (http/https)

### 4. **SSL 证书错误**

#### **错误信息**
```
Error: certificate verify failed
```

#### **解决方案**
1. **检查系统时间**
   - 确保系统时间正确
   - 同步网络时间

2. **更新证书**
   - 更新操作系统
   - 更新浏览器

### 5. **API Key 相关错误**

#### **401 Unauthorized**
- API Key 无效或已过期
- API Key 格式错误

#### **403 Forbidden**
- API Key 权限不足
- 账户余额不足

#### **429 Too Many Requests**
- API 调用频率超限
- 需要等待或升级套餐

## 🛠️ 诊断工具使用

### **内置网络诊断**
1. 进入设置页面
2. 在 AI 配置部分点击 🌐 按钮
3. 点击"开始诊断"
4. 查看详细的测试结果

### **诊断结果解读**

#### **连接测试**
- ✅ **成功**: 网络连接正常
- ❌ **失败**: 检查网络和 API 地址

#### **API 响应测试**
- ✅ **成功**: API Key 有效，服务正常
- ❌ **失败**: 检查 API Key 或服务状态

#### **DNS 解析**
- ✅ **成功**: 域名解析正常
- ❌ **失败**: 检查域名拼写或 DNS 设置

## 🔧 高级排查

### **使用浏览器开发者工具**
1. 按 F12 打开开发者工具
2. 切换到 Network 标签
3. 重现错误操作
4. 查看失败的请求详情

### **检查代理设置**
- 确认是否使用了代理服务器
- 验证代理配置是否正确
- 尝试禁用代理

### **防火墙和安全软件**
- 临时禁用防火墙测试
- 检查安全软件是否阻止连接
- 添加应用到白名单

## 📞 获取帮助

如果以上方法都无法解决问题，请：

1. **收集错误信息**
   - 完整的错误消息
   - 网络诊断结果
   - 使用的操作系统和浏览器版本

2. **联系技术支持**
   - 提供详细的错误描述
   - 附上诊断报告
   - 说明已尝试的解决方案

## 🎯 预防措施

1. **定期检查配置**
   - 验证 API Key 有效性
   - 确认 API 地址正确性

2. **监控网络状态**
   - 使用稳定的网络连接
   - 避免在网络不稳定时进行重要操作

3. **备用方案**
   - 准备多个 API Key
   - 配置备用 API 服务

通过以上指南，您应该能够诊断和解决大部分网络连接问题。如果问题持续存在，建议使用内置的诊断工具获取更详细的错误信息。

# 每日调用限制范围更新

## 更新概述

根据您的要求，已将每日调用限制的范围从 `1-1000` 更新为 `150-99999`，并支持无限制选项。

## 设计理念

### 📊 **按人数计算**
- **基准**: 每人每天 150 次调用
- **最小值**: 150 次（支持 1 人使用）
- **最大值**: 99999 次（支持 666 人使用）
- **无限制**: 999999（特殊值，表示不限制）

### 🎯 **实际应用场景**
```
150 次/天  → 1 人使用
300 次/天  → 2 人使用
750 次/天  → 5 人使用
1500 次/天 → 10 人使用
3000 次/天 → 20 人使用
7500 次/天 → 50 人使用
15000 次/天 → 100 人使用
99999 次/天 → 666 人使用
无限制     → 不限制人数
```

## 技术实现

### 🔧 **前端界面更新**

#### **输入控件**
- **范围验证**: 150-99999
- **默认值**: 150
- **无限制选项**: 复选框控制
- **实时计算**: 显示可支持的人数

#### **用户体验**
```typescript
// 智能提示
按每人每天150次计算，可支持 {Math.floor(dailyLimit / 150)} 人使用

// 无限制处理
{config.dailyLimit === 999999 ? "无限" : Math.floor(config.dailyLimit / 150)} 人使用
```

### 🛡️ **后端验证更新**

#### **API 验证**
```typescript
// 新的验证逻辑
if (dailyLimit && dailyLimit !== 999999 && (dailyLimit < 150 || dailyLimit > 99999)) {
  return NextResponse.json({
    error: 'Daily limit must be between 150 and 99999, or 999999 for unlimited'
  }, { status: 400 })
}
```

#### **KeyManager 更新**
```typescript
// 支持无限制的过滤逻辑
const availableKeys = keys.filter(key => 
  key.daily_limit === 999999 || (key.usage_count_today || 0) < (key.daily_limit || 150)
)
```

### 🗄️ **数据库更新**

#### **表结构**
```sql
-- 更新默认值
daily_limit integer DEFAULT 150,

-- 支持的值范围
-- 150-99999: 正常限制
-- 999999: 无限制标识
```

#### **迁移脚本**
- 更新默认值为 150
- 将现有小于 150 的值更新为 150
- 提供验证和统计查询

## 界面变化

### 📱 **配置界面**

#### **输入区域**
```
每日调用限制
┌─────────────────────────────┐
│ [150-99999 或留空]          │
└─────────────────────────────┘
☐ 无限制（不推荐）

按每人每天150次计算，可支持 X 人使用
```

#### **智能提示**
- **输入验证**: 自动限制在 150-99999 范围内
- **人数计算**: 实时显示可支持的用户数
- **无限制警告**: 提醒用户谨慎使用

### 🔍 **状态显示**

#### **管理界面**
- **当前限制**: 显示具体数值或"无限制"
- **使用情况**: "今日已使用 X/Y 次" 或 "今日已使用 X 次（无限制）"
- **支持人数**: "可支持约 X 人使用"

## 使用建议

### 👥 **按团队规模**

#### **个人项目**
- **推荐**: 150-300 次/天
- **说明**: 支持 1-2 人使用
- **适用**: 个人学习、小型项目

#### **小团队**
- **推荐**: 750-1500 次/天
- **说明**: 支持 5-10 人使用
- **适用**: 小型团队、初创公司

#### **中型团队**
- **推荐**: 3000-7500 次/天
- **说明**: 支持 20-50 人使用
- **适用**: 中型公司、部门级项目

#### **大型团队**
- **推荐**: 15000+ 次/天
- **说明**: 支持 100+ 人使用
- **适用**: 大型企业、开放平台

#### **社区开放**
- **推荐**: 无限制（999999）
- **说明**: 不限制使用人数
- **注意**: 需要充足的 API 预算

### ⚠️ **注意事项**

#### **成本控制**
- **预算评估**: 根据 API 定价计算每日成本
- **监控使用**: 定期查看使用统计
- **及时调整**: 根据实际情况调整限制

#### **无限制风险**
- **成本风险**: 可能产生高额 API 费用
- **滥用风险**: 可能被恶意大量调用
- **建议**: 仅在有充足预算和信任环境下使用

## 迁移步骤

### 1️⃣ **数据库迁移**
```bash
# 执行迁移脚本
psql -f database-migration-daily-limit-update.sql
```

### 2️⃣ **代码部署**
```bash
# 部署更新后的代码
git add .
git commit -m "feat: 更新每日调用限制范围支持150-99999和无限制"
git push origin main
```

### 3️⃣ **验证功能**
- 测试新的限制范围
- 验证无限制选项
- 检查人数计算显示

### 4️⃣ **用户通知**
- 通知现有用户新的限制范围
- 说明无限制选项的使用建议
- 提供迁移指导

## 预期效果

### ✅ **用户体验提升**
- **更灵活的配置**: 支持更大范围的使用场景
- **直观的人数显示**: 用户可以清楚了解可支持的人数
- **智能的默认值**: 150 次适合大多数个人用户

### 📈 **功能增强**
- **支持大团队**: 可以配置支持数百人的使用
- **无限制选项**: 满足开放社区的需求
- **成本可控**: 用户可以根据预算灵活设置

这个更新让共享 API Key 功能更加实用和灵活，能够满足从个人到大型团队的各种使用需求！

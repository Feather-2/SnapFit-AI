# 最简化的 Dockerfile 用于测试
FROM node:20-alpine

# 安装基本依赖
RUN apk add --no-cache libc6-compat

WORKDIR /app

# 复制包管理文件
COPY package.json pnpm-lock.yaml* ./

# 启用 pnpm 并安装依赖
RUN corepack enable pnpm && pnpm i --frozen-lockfile

# 复制源代码
COPY . .

# 设置环境变量
ENV NEXT_TELEMETRY_DISABLED=1
ENV NODE_ENV=production
ENV SKIP_ENV_VALIDATION=1

# 生成 Prisma 客户端
RUN npx prisma generate

# 构建应用
RUN pnpm build

EXPOSE 3000

CMD ["pnpm", "start"]
